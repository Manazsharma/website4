---
title: Parsing Syslog Messages from MikroTik Routers Using Regular expressions
seoTitle: "Unlocking MikroTik Router Insights: Effortlessly Parse Syslog Messages with Regular Expressions"
description: "MikroTik routers, widely recognized for their robustness and versatility, generate syslog messages that can be intricate due to their unique formatting. OpenObserve, with its Vector Remap Language (VRL), provides a powerful way to parse these messages, but the built-in parse_syslog function may not always handle MikroTik's log format effectively. That's where parse_regex comes into play, offering the flexibility needed to extract meaningful data from MikroTik's syslog messages."
img: img/blog/parse1.webp
alt: OpenObserve
slug: parsing-mikrotik-syslog-messages
authors: 
  - prabhat
publishDate: 2024-03-05
tags:
  - syslog
  - regex
  - mikrotik
  - parsing
  - logs
---

### Introduction

When it comes to network management, parsing and analyzing syslog messages is a critical task that helps administrators understand and troubleshoot network behavior. MikroTik routers, widely recognized for their robustness and versatility, generate syslog messages that can be intricate due to their unique formatting. OpenObserve, with its Vector Remap Language (VRL), provides a powerful way to parse these messages, but the built-in `parse_syslog` function may not always handle MikroTik's log format effectively. That's where `parse_regex` comes into play, offering the flexibility needed to extract meaningful data from MikroTik's syslog messages.

### Understanding the Challenge with MikroTik Syslog Messages

MikroTik routers produce syslog messages that contain valuable information about network events, such as firewall actions, system errors, and other operational data. Below are some examples of syslog messages generated by a MikroTik router:

```
2024-03-04T21:58:06.625318+00:00 testing-router firewall,info input: in:ether5-S2S out:(unknown 0), connection-mark:to_ether5 connection-state:established src-mac 00:01:5c:9f:f0:46, proto 50, xxx.yyy.zzz.www->aaa.bbb.ccc.ddd, len 140
2024-03-04T22:58:13+00:00 testing-router input: in:ether5-S2S out:(unknown 0), connection-mark:to_ether5 connection-state:established src-mac 00:01:5c:9f:f0:46, proto 50, xxx.yyy.zzz.www->aaa.bbb.ccc.ddd, len 156
2024-03-04T22:58:13+00:00 testing-router input: in:ether5-S2S out:(unknown 0), connection-mark:to_ether5 connection-state:established proto 47, xxx.yyy.zzz.www->aaa.bbb.ccc.ddd, len 100
```

Once ingested into OpenObserve, they may appear as JSON objects like this:

```json
{
    "log": "2024-03-04T22:58:13+00:00 testing-router input: in:ether5-S2S out:(unknown 0), connection-mark:to_ether5 connection-state:established proto 47, xxx.yyy.zzz.www->aaa.bbb.ccc.ddd, len 100"
}
```

### The Power of `parse_regex` in VRL

To extract the valuable data points from the MikroTik syslog messages, we can employ the `parse_regex` function in VRL. This function allows us to define a regular expression that matches the structure and content of the log messages.

Here is the regular expression pattern used for parsing the sample logs:

```code
pattern = r'(?P<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:\+\d{2}:\d{2})?)\s+(?P<router>\S+)\s+(?:(?P<message_type>[^ ]+)\s+)?input:\s+in:(?  P<in_iface>[^ ]+)\s+out:\((?P<out_iface>[^)]+)\),\s+connection-mark:(?P<connection_mark>\S+)\s+connection-state:(?P<connection_state>\S+)(?:\s+src-mac\s+(?P<src_mac>[^,]+),)?\s+proto\s+(?P<proto>\d+),\s+(?P<src_ip>[^->]+)->(?P<dst_ip>[^,]+),\s+len\s+(?P<length>\d+)'
```

The `parse_regex` function then applies this pattern to the `.log` field of the incoming JSON object:

```regex
# Parse the log using the regex pattern
.log = parse_regex!(.log, pattern)
```

### Breaking Down the Regex Pattern

The regex pattern is a sequence of named groups that correspond to the different parts of the syslog message we want to extract:

- `(?P<timestamp>...)`: Captures the timestamp when the event occurred.
- `(?P<router>\S+)`: Captures the name of the router that generated the log.
- `(?P<message_type>[^ ]+)`: Optionally captures the type of message, which may not be present in all logs.
- `(?P<in_iface>[^ ]+)`: Captures the input interface through which the packet entered.
- `(?P<out_iface>[^)]+)`: Captures the output interface through which the packet is intended to leave.
- `(?P<connection_mark>\S+)`: Captures the connection mark assigned by the router's firewall.
- `(?P<connection_state>\S+)`: Captures the state of the connection.
- `(?P<src_mac>[^,]+)`: Optionally captures the source MAC address of the packet.
- `(?P<proto>\d+)`: Captures the protocol number.
- `(?P<src_ip>[^->]+)`: Captures the source IP address.
- `(?P<dst_ip>[^,]+)`: Captures the destination IP address.
- `(?P<length>\d+)`: Captures the length of the packet.

### Example of Parsed Data

When the `parse_regex` function is applied to the syslog message, the output is a structured JSON object that clearly delineates the extracted data:

```json
{
    "log": {
        "timestamp": "2024-03-04T22:58:13+00:00",
        "router": "testing-router",
        "message_type": null,
        "in_iface": "ether5-S2S",
        "out_iface": "unknown 0",
        "connection_mark": "to_ether5",
        "connection_state": "established",
        "src_mac": null,
        "proto": "47",
        "src_ip": "xxx.yyy.zzz.www",
        "dst_ip": "aaa.bbb.ccc.ddd",
        "length": "100"
    }
}
```

This structured data is now ready for further analysis or alerting within OpenObserve. By leveraging the `parse_regex` function, network administrators can transform MikroTik's complex syslog messages into actionable insights, contributing to more effective network monitoring and management.
